steps:
- checkout: self
  fetchDepth: 5

- script: ./python Tools/scripts/patchcheck.py --travis true
  displayName: 'Run patchcheck.py'
  condition: and(succeeded(), eq(variables['Build.Reason'], 'PullRequest'))

- script: |
   git fetch -q origin $(System.PullRequest.TargetBranch)
   if ! git diff --name-only HEAD $(git merge-base HEAD FETCH_HEAD) | grep -qvE '(\.rst$|^Doc|^Misc)'
   then
     echo "Only docs were updated: RunTests=false"
     echo "##vso[task.setvariable variable=RunTests,isOutput=true]false"
   else
     echo "Code was updated: RunTests=true"
     echo "##vso[task.setvariable variable=RunTests,isOutput=true]true"
   fi
   if ! git diff --name-only HEAD $(git merge-base HEAD FETCH_HEAD) | grep -qE '(\.rst$|^Doc|^Misc)'
   then
     echo "No docs were updated: BuildDocs=false"
     echo "##vso[task.setvariable variable=BuildDocs,isOutput=true]false"
   else
     echo "Docs were updated: BuildDocs=true"
     echo "##vso[task.setvariable variable=BuildDocs,isOutput=true]true"
   fi
   echo "##vso[task.setvariable variable=DocOnly,isOutput=true]true"
  displayName: Detect doc changes
  condition: and(succeeded(), variables['System.PullRequest.TargetBranch'])
